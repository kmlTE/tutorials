h1 /usr/sbin/sshd -D &
h1 export SSH_ASKPASS=~/p4/mpi/mpitutorial/tutorials/ping-pong-lat/code/pass
h1 export MPI_HOSTS=~/p4/mpi/mpitutorial/tutorials/ping-pong-lat/code/hosts-topo-3

h7 /usr/sbin/sshd -D &
h7 export SSH_ASKPASS=~/p4/mpi/mpitutorial/tutorials/ping-pong-lat/code/pass
h7 export MPI_HOSTS=~/p4/mpi/mpitutorial/tutorials/ping-pong-lat/code/hosts-topo-3


h1 ssh-keyscan -H host-7 >> ~/.ssh/known_hosts &
h7 ssh-keyscan -H host-1 >> ~/.ssh/known_hosts &



h8 iperf -s -i 1 -y C -e ${UDP_FLAG} > ${PREFIX}/h8-iperf.csv &
h9 iperf -s -i 1 -y C -e ${UDP_FLAG} > ${PREFIX}/h9-iperf.csv &

h10 iperf -s -i 1 -y C -e ${UDP_FLAG} > ${PREFIX}/h10-iperf.csv &
h11 iperf -s -i 1 -y C -e ${UDP_FLAG} > ${PREFIX}/h11-iperf.csv &
h12 iperf -s -i 1 -y C -e ${UDP_FLAG} > ${PREFIX}/h12-iperf.csv &


h2 iperf -c h8 -t ${IPERF_TIME} -i 1 -y C -e ${UDP_ARGS} > ${PREFIX}/h2-iperf.csv &
h3 iperf -c h9 -t ${IPERF_TIME} -i 1 -y C -e ${UDP_ARGS} > ${PREFIX}/h3-iperf.csv &

h4 iperf -c h10 -t ${IPERF_TIME} -i 1 -y C -e ${UDP_ARGS} > ${PREFIX}/h4-iperf.csv &
h5 iperf -c h11 -t ${IPERF_TIME} -i 1 -y C -e ${UDP_ARGS} > ${PREFIX}/h5-iperf.csv &
h6 iperf -c h12 -t ${IPERF_TIME} -i 1 -y C -e ${UDP_ARGS} > ${PREFIX}/h6-iperf.csv &

h1 ./dump_cpu_ps.sh | tee ${PREFIX}/cpu-util.csv &
h1 cd ~/p4/mpi/mpitutorial/tutorials/ && ./run.py ping_pong_lat | tee ${PREFIX}/h1-mpi.csv && kill %%